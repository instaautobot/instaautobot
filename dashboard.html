<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InstaAutoBot | Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0a0f1c;
      color: #f1f5f9;
      line-height: 1.6;
    }
    .dashboard {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }
    .sidebar {
      background: #111827;
      padding: 2rem;
      border-right: 1px solid #1e293b;
    }
    .sidebar h1 {
      color: #60a5fa;
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }
    .nav-menu {
      list-style: none;
    }
    .nav-menu li {
      margin-bottom: 0.5rem;
    }
    .nav-menu a {
      color: #94a3b8;
      text-decoration: none;
      display: block;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .nav-menu a:hover,
    .nav-menu a.active {
      background: #1e293b;
      color: #60a5fa;
    }
    .main-content {
      padding: 2rem;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: #1e293b;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .stat-card h3 {
      color: #94a3b8;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
    .stat-card .value {
      color: #60a5fa;
      font-size: 1.5rem;
      font-weight: 600;
    }
    .settings-section {
      background: #1e293b;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
    }
    .settings-section h2 {
      color: #60a5fa;
      margin-bottom: 1.5rem;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #94a3b8;
    }
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #0f172a;
      color: #f1f5f9;
      font-size: 1rem;
    }
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .btn:hover {
      background: #2563eb;
    }
    .btn-danger {
      background: #ef4444;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .alert-success {
      background: #065f46;
      color: #d1fae5;
    }
    .alert-error {
      background: #991b1b;
      color: #fee2e2;
    }
    /* Notification Styles */
    .checkbox-group {
      display: grid;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #94a3b8;
    }
    .checkbox-label input[type="checkbox"] {
      width: 1.2rem;
      height: 1.2rem;
    }
    .notifications-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .notification-item {
      background: #0f172a;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
    }
    .notification-item.unread {
      border-left-color: #60a5fa;
    }
    .notification-item h3 {
      color: #60a5fa;
      margin-bottom: 0.5rem;
    }
    .notification-item p {
      color: #94a3b8;
      font-size: 0.875rem;
    }
    .notification-item .time {
      color: #64748b;
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <h1>InstaAutoBot</h1>
      <ul class="nav-menu">
        <li><a href="#overview" class="active">Overview</a></li>
        <li><a href="#automation">Automation</a></li>
        <li><a href="#settings">Settings</a></li>
        <li><a href="#billing">Billing</a></li>
        <li><a href="#notifications">Notifications</a></li>
        <li><a href="#" id="logoutBtn">Logout</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <div id="overview" class="section">
        <h2>Dashboard Overview</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total DMs</h3>
            <div class="value" id="totalDMs">0</div>
          </div>
          <div class="stat-card">
            <h3>Auto-Replies</h3>
            <div class="value" id="autoReplies">0</div>
          </div>
          <div class="stat-card">
            <h3>Subscription</h3>
            <div class="value" id="subscription">Free</div>
          </div>
          <div class="stat-card">
            <h3>Remaining DMs</h3>
            <div class="value" id="remainingDMs">50</div>
          </div>
        </div>
      </div>

      <div id="automation" class="section" style="display: none;">
        <div class="settings-section">
          <h2>Instagram Connection</h2>
          <div class="form-group">
            <label for="instagramUsername">Instagram Username</label>
            <input type="text" id="instagramUsername" placeholder="Enter your Instagram username">
          </div>
          <div class="form-group">
            <label for="instagramPassword">Instagram Password</label>
            <input type="password" id="instagramPassword" placeholder="Enter your Instagram password">
          </div>
          <button class="btn" id="connectInstagram">Connect Instagram</button>
        </div>

        <div class="settings-section">
          <h2>Auto-Reply Settings</h2>
          <div class="form-group">
            <label for="autoReplyMessage">Default Reply Message</label>
            <textarea id="autoReplyMessage" placeholder="Enter your default reply message"></textarea>
          </div>
          <div class="form-group">
            <label for="keywords">Keywords (comma-separated)</label>
            <input type="text" id="keywords" placeholder="Enter keywords to trigger auto-replies">
          </div>
          <button class="btn" id="saveAutoReply">Save Auto-Reply Settings</button>
        </div>
      </div>

      <div id="settings" class="section" style="display: none;">
        <div class="settings-section">
          <h2>Account Settings</h2>
          <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" placeholder="Enter your full name">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Enter your email">
          </div>
          <button class="btn" id="saveSettings">Save Settings</button>
        </div>
      </div>

      <div id="billing" class="section" style="display: none;">
        <div class="settings-section">
          <h2>Subscription Management</h2>
          <div class="form-group">
            <label>Current Plan</label>
            <div id="currentPlan">Free Plan</div>
          </div>
          <div class="form-group">
            <label>Upgrade Plan</label>
            <select id="planSelect" class="form-control">
              <option value="pro">Pro Plan - â‚¬15/mo</option>
              <option value="elite">Elite Plan - $29/mo</option>
            </select>
          </div>
          <button class="btn" id="upgradePlan">Upgrade Plan</button>
          <button class="btn btn-danger" id="cancelSubscription">Cancel Subscription</button>
        </div>
      </div>

      <div id="notifications" class="section" style="display: none;">
        <div class="settings-section">
          <h2>Notification Settings</h2>
          <div class="form-group">
            <label>Email Notifications</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="notifyDMs" checked>
                Direct Messages
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="notifySubscription" checked>
                Subscription Updates
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="notifySecurity" checked>
                Security Alerts
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="notifySystem" checked>
                System Updates
              </label>
            </div>
          </div>
          <button class="btn" id="saveNotificationSettings">Save Settings</button>
        </div>

        <div class="settings-section">
          <h2>Recent Notifications</h2>
          <div id="notificationsList" class="notifications-list">
            <!-- Notifications will be loaded here -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // API Configuration
    const API_URL = 'http://localhost:5000/api';
    let authToken = localStorage.getItem('token');

    // Check authentication
    if (!authToken) {
      window.location.href = 'index.html';
    }

    // Navigation
    document.querySelectorAll('.nav-menu a').forEach(link => {
      link.addEventListener('click', (e) => {
        if (e.target.id === 'logoutBtn') {
          localStorage.removeItem('token');
          window.location.href = 'index.html';
          return;
        }

        e.preventDefault();
        const targetId = e.target.getAttribute('href').substring(1);
        
        // Update active link
        document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
        e.target.classList.add('active');

        // Show target section
        document.querySelectorAll('.section').forEach(section => {
          section.style.display = 'none';
        });
        document.getElementById(targetId).style.display = 'block';

        // Load section data
        if (targetId === 'overview') {
          loadDashboardStats();
        } else if (targetId === 'notifications') {
          loadNotifications();
        }
      });
    });

    // Load Dashboard Statistics
    async function loadDashboardStats() {
      try {
        const response = await fetch(`${API_URL}/instagram/stats`, {
          headers: {
            'x-auth-token': authToken
          }
        });
        const data = await response.json();
        
        document.getElementById('totalDMs').textContent = data.dmCount;
        document.getElementById('subscription').textContent = data.subscription;
        document.getElementById('remainingDMs').textContent = data.remainingDMs;
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Instagram Connection
    document.getElementById('connectInstagram').addEventListener('click', async () => {
      const username = document.getElementById('instagramUsername').value;
      const password = document.getElementById('instagramPassword').value;

      try {
        const response = await fetch(`${API_URL}/instagram/connect`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-auth-token': authToken
          },
          body: JSON.stringify({ username, password })
        });
        const data = await response.json();
        alert(data.message);
      } catch (error) {
        console.error('Error connecting Instagram:', error);
        alert('Error connecting Instagram account');
      }
    });

    // Auto-Reply Settings
    document.getElementById('saveAutoReply').addEventListener('click', async () => {
      const message = document.getElementById('autoReplyMessage').value;
      const keywords = document.getElementById('keywords').value.split(',').map(k => k.trim());

      try {
        const response = await fetch(`${API_URL}/instagram/auto-reply`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-auth-token': authToken
          },
          body: JSON.stringify({ message, keywords })
        });
        const data = await response.json();
        alert(data.message);
      } catch (error) {
        console.error('Error saving auto-reply settings:', error);
        alert('Error saving auto-reply settings');
      }
    });

    // Load Notifications
    async function loadNotifications() {
      try {
        const response = await fetch(`${API_URL}/notifications`, {
          headers: {
            'x-auth-token': authToken
          }
        });
        const notifications = await response.json();
        
        const notificationsList = document.getElementById('notificationsList');
        notificationsList.innerHTML = notifications.map(notification => `
          <div class="notification-item ${notification.isRead ? '' : 'unread'}">
            <h3>${notification.title}</h3>
            <p>${notification.message}</p>
            <div class="time">${new Date(notification.createdAt).toLocaleString()}</div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading notifications:', error);
      }
    }

    // Save Notification Settings
    document.getElementById('saveNotificationSettings').addEventListener('click', async () => {
      const settings = {
        notifyDMs: document.getElementById('notifyDMs').checked,
        notifySubscription: document.getElementById('notifySubscription').checked,
        notifySecurity: document.getElementById('notifySecurity').checked,
        notifySystem: document.getElementById('notifySystem').checked
      };

      try {
        const response = await fetch(`${API_URL}/notifications/settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-auth-token': authToken
          },
          body: JSON.stringify(settings)
        });
        const data = await response.json();
        alert('Notification settings saved successfully!');
      } catch (error) {
        console.error('Error saving notification settings:', error);
        alert('Error saving notification settings');
      }
    });

    // Load initial dashboard data
    loadDashboardStats();
  </script>
</body>
</html> 